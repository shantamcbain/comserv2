Index: Comserv/root/Documentation/index.tt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!-- File: /home/shanta/PycharmProjects/comserv/Comserv/root/Documentation/index.tt -->\n[% PageVersion = 'Documentation/index.tt,v 1.6 2025/04/08 shanta Exp shanta ' %]\n[% IF c.session.debug_mode == 1 %]\n    [% PageVersion %]\n[% END %]\n<head>\n    <link rel=\"stylesheet\" href=\"[% c.uri_for('/static/css/components/documentation.css') %]\">\n</head>\n[%# Determine user role for display %]\n[% SET display_role = 'Guest' %]\n[% IF c.session.roles %]\n    [% IF c.session.roles.grep('admin').size %]\n        [% SET display_role = 'Administrator' %]\n    [% ELSIF c.session.roles.grep('developer').size %]\n        [% SET display_role = 'Developer' %]\n    [% ELSIF c.session.roles.grep('editor').size %]\n        [% SET display_role = 'Editor' %]\n    [% ELSIF c.session.roles.grep('user').size %]\n        [% SET display_role = 'User' %]\n    [% END %]\n[% END %]\n\n[% IF c.session.debug_mode == 1 %]\n<div class=\"debug-info\">\n    <h3>Debug Information</h3>\n    <p>User Role from Controller: [% user_role %]</p>\n    <p>Display Role from Template: [% display_role %]</p>\n    <p>Session Roles: [% c.session.roles.join(', ') IF c.session.roles %]</p>\n    <p>Debug Message: [% debug_msg %]</p>\n    <p>Categories Available:</p>\n    <ul>\n        <li>user_guides: [% categories.user_guides ? 'Yes' : 'No' %]</li>\n        <li>tutorials: [% categories.tutorials ? 'Yes' : 'No' %]</li>\n        <li>site_specific: [% categories.site_specific ? 'Yes' : 'No' %]</li>\n        <li>admin_guides: [% categories.admin_guides ? 'Yes' : 'No' %]</li>\n        <li>proxmox: [% categories.proxmox ? 'Yes' : 'No' %]</li>\n        <li>controllers: [% categories.controllers ? 'Yes' : 'No' %]</li>\n        <li>models: [% categories.models ? 'Yes' : 'No' %]</li>\n        <li>changelog: [% categories.changelog ? 'Yes' : 'No' %]</li>\n        <li>general: [% categories.general ? 'Yes' : 'No' %]</li>\n    </ul>\n    \n    <h4>Controller Documentation Files:</h4>\n    <ul>\n        [% IF categories.controllers && categories.controllers.pages.size > 0 %]\n            [% FOREACH page_name IN categories.controllers.pages.sort %]\n                <li>[% page_name %] - [% structured_pages.$page_name ? 'Found' : 'Not Found' %]</li>\n            [% END %]\n        [% ELSE %]\n            <li>No controller documentation files found.</li>\n        [% END %]\n    </ul>\n    \n    <h4>Model Documentation Files:</h4>\n    <ul>\n        [% IF categories.models && categories.models.pages.size > 0 %]\n            [% FOREACH page_name IN categories.models.pages.sort %]\n                <li>[% page_name %] - [% structured_pages.$page_name ? 'Found' : 'Not Found' %]</li>\n            [% END %]\n        [% ELSE %]\n            <li>No model documentation files found.</li>\n        [% END %]\n    </ul>\n</div>\n[% END %]\n\n<div class=\"documentation-container\">\n    <header class=\"doc-header\">\n        <h1>Comserv Documentation</h1>\n        <div class=\"user-context\">\n            <span class=\"context-item\"><strong>Site:</strong> [% site_name || 'Comserv' %]</span>\n            <span class=\"context-item\"><strong>Role:</strong> [% display_role %]</span>\n        </div>\n    </header>\n    <p class=\"intro\">Comprehensive guides and resources for the Comserv system, tailored to your role and site.</p>\n\n[%# User-facing sections %]\n[% INCLUDE 'Documentation/user_docs.tt' %]\n[% INCLUDE 'Documentation/tutorials.tt' %]\n[% INCLUDE 'Documentation/site_specific.tt' %]\n\n[%# Admin-only sections %]\n[% # Use the is_admin flag passed from the controller %]\n[% IF is_admin %]\n    [% # Debug output %]\n    [% IF c.session.debug_mode == 1 %]\n        <div class=\"debug-info\">\n            <p>Admin sections visible: user_role=[% user_role %], session roles=[% c.session.roles.join(',') IF c.session.roles %]</p>\n        </div>\n    [% END %]\n    [% INCLUDE 'Documentation/admin_guides.tt' %]\n    [% INCLUDE 'Documentation/proxmox.tt' %]\n    [% INCLUDE 'Documentation/controllers.tt' %]\n    [% INCLUDE 'Documentation/models.tt' %]\n    [% INCLUDE 'Documentation/changelog.tt' %]\n    [% INCLUDE 'Documentation/all_docs.tt' %]\n[% END %]\n\n[%# Admin/Developer/Debug sections %]\n[% IF display_role == 'Administrator' || display_role == 'Developer' || c.session.debug_mode == 1 %]\n    [% INCLUDE 'Documentation/system_info.tt' %]\n[% END %]\n\n[% INCLUDE 'Documentation/recent_updates.tt' %]\n</div>\n\n<script>\n    document.addEventListener('DOMContentLoaded', function() {\n        document.querySelectorAll('.section-toggle').forEach(header => {\n            header.addEventListener('click', function() {\n                this.classList.toggle('expanded');\n                // Find the next .section-content element within the same section\n                const section = this.closest('.doc-section');\n                const content = section.querySelector('.section-content');\n                \n                if (content.classList.contains('expanded')) {\n                    content.style.maxHeight = '0';\n                    content.classList.remove('expanded');\n                } else {\n                    content.style.maxHeight = content.scrollHeight + 'px';\n                    content.classList.add('expanded');\n                }\n            });\n        });\n        \n        // Initialize all expanded sections\n        document.querySelectorAll('.section-content.expanded').forEach(content => {\n            content.style.maxHeight = content.scrollHeight + 'px';\n        });\n    });\n\n    function showFileType(evt, fileType) {\n        var contents = document.getElementsByClassName('section-content');\n        for (var i = 0; i < contents.length; i++) {\n            contents[i].style.display = 'none';\n            contents[i].classList.remove('active');\n        }\n        var tabs = document.getElementsByClassName('file-type-tab');\n        for (var i = 0; i < tabs.length; i++) {\n            tabs[i].classList.remove('active');\n        }\n        var activeContent = document.getElementById(fileType);\n        activeContent.style.display = 'grid';\n        activeContent.classList.add('active');\n        activeContent.style.maxHeight = activeContent.scrollHeight + 'px';\n        evt.currentTarget.classList.add('active');\n    }\n</script>\n\n<style>\n    /* Your existing CSS unchanged */\n    .documentation-container {\n        max-width: 1200px;\n        margin: 0 auto;\n        padding: 20px;\n        font-family: Arial, sans-serif;\n        background: #f8f9fa;\n    }\n    \n\n    /* ... rest of your CSS ... */\n</style>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Comserv/root/Documentation/index.tt b/Comserv/root/Documentation/index.tt
--- a/Comserv/root/Documentation/index.tt	(revision d6986418ffb6901ec812bfbf277b71cbf8324a0d)
+++ b/Comserv/root/Documentation/index.tt	(date 1748270756932)
@@ -73,6 +73,12 @@
         </div>
     </header>
     <p class="intro">Comprehensive guides and resources for the Comserv system, tailored to your role and site.</p>
+    
+    [% IF display_role == 'Administrator' || display_role == 'Developer' %]
+    <div class="legacy-doc-link">
+        <p><small>Looking for the legacy documentation? <a href="[% c.uri_for('/Documentation/ComservDocumentation') %]">View the original documentation page</a>.</small></p>
+    </div>
+    [% END %]
 
 [%# User-facing sections %]
 [% INCLUDE 'Documentation/user_docs.tt' %]
@@ -157,6 +163,22 @@
         background: #f8f9fa;
     }
     
+    .legacy-doc-link {
+        margin-bottom: 20px;
+        font-size: 0.9em;
+        color: #666;
+        border-bottom: 1px solid #eee;
+        padding-bottom: 10px;
+    }
+    
+    .legacy-doc-link a {
+        color: #0056b3;
+        text-decoration: none;
+    }
+    
+    .legacy-doc-link a:hover {
+        text-decoration: underline;
+    }
 
     /* ... rest of your CSS ... */
 </style>
\ No newline at end of file
