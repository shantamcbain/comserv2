<head>
    [% PageVersion = 'Header.tt,v 0.01 2023/08/30 shanta Exp shanta ' %]
    <meta charset="utf-8">
    [% IF c.session.debug_mode == 1 %]
        [% PageVersion %]
    [% END %]
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="REVISIT-AFTER" content="7 days">
    <meta name="ROBOTS" content="index all, follow all">
    <meta charset="utf-8">
    [% # Make sure HostName is defined, use a default if not %]
    [% UNLESS HostName %]
        [% HostName = "http://" _ c.req.uri.host %]
        [% IF c.session.debug_mode == 1 %]
            <!-- Warning: HostName was not defined, using default: [% HostName %] -->
        [% END %]
    [% END %]
    <title>[% HostName _ ': ' _ ScriptDisplayName _ ': ' _ page_title %]</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="REVISIT-AFTER" content="7 days">
    <meta name="ROBOTS" content="index all, follow all">
    [% IF keywords %]
        <meta name="keywords" content="[% keywords %]">
    [% ELSE %]
        <meta name="keywords" content="[% data.http_header_keywords %]">
    [% END %]
    [% IF description %]
        <meta name="description" content="[% description %]">
    [% ELSE %]
        <meta name="description" content="[% http_header_description %]">
    [% END %]
    <link rel="shortcut icon" href="/static/images/favicon.ico">
    [% IF SiteName == "CSC" %]
        [% embed('CSCWHMCSInterface') %]
    [% END %]

    <!-- Base CSS with variables -->
    <link rel="stylesheet" type="text/css" href="/static/css/base.css">

    <!-- Theme CSS - using JSON-based theme system -->
    [%
        # The theme_name should be set in the stash by the ThemeManager
        # But we'll add a fallback just in case

        # First check if we have a site-specific theme in the session
        site_key = "theme_" _ SiteName.lower;

        IF c.session.$site_key;
            theme_name = c.session.$site_key;
        ELSIF c.stash.theme_name;
            theme_name = c.stash.theme_name;
        ELSIF c.session.theme_name;
            theme_name = c.session.theme_name;
        ELSIF site && site.theme;
            theme_name = site.theme;
        ELSE;
            theme_name = 'default';
        END;

        # Log the theme selection
        IF c.session.debug_mode == 1;
            c.log.info("Selected theme: " _ theme_name _ " for site: " _ SiteName);
            IF available_themes;
                c.log.info("Available themes: " _ available_themes.join(", "));
            END;
        END;
    %]
    <!-- Theme CSS: [% theme_name %] -->
    <link rel="stylesheet" type="text/css" href="/static/css/themes/[% theme_name %].css">

    <!-- Theme overrides to ensure proper application -->
    <link rel="stylesheet" type="text/css" href="/static/css/theme-overrides.css">

    <!-- Add theme class to body -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.body.classList.add('theme-[% theme_name %]');
        });
    </script>

    [% IF c.session.debug_mode == 1 %]
    <!-- Debug: Site name is [% SiteName %] -->
    [% END %]

    <!-- Menu CSS (part of theme system) -->
    <link rel="stylesheet" type="text/css" href="/static/css/menu-theme.css">

    <!-- Debug: Using theme system only, removed old CSS references -->
    [% IF c.session.debug_mode == 1 %]
    <!-- Removed old CSS references: css_view_name, log_css, menu_css, todo_css -->
    [% END %]

    <!-- Local SVG icon solution (no external dependencies) -->
    <link rel="stylesheet" type="text/css" href="/static/css/svg-icons.css">

    <!-- Fix for icons to respect theme colors -->
    <link rel="stylesheet" type="text/css" href="/static/css/icon-fix.css">

    <!-- jQuery for AJAX functionality -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    
    <!-- JavaScript dependencies -->
    <script src="/static/js/sub-menu.js"></script>
    <script src="/static/js/menu.js"></script>
    <script language="javascript" type="text/javascript">
        function switchpage(select) {
            var index;
            for (index = 0; index < select.options.length; index++) {
                if (select.options[index].selected) {
                    if (select.options[index].value !== "") {
                        window.location.href = select.options[index].value;
                        break;
                    }
                }
            }
        }
    </script>
</head>
