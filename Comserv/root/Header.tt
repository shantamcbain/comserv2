<head>
    [% PageVersion = 'Header.tt,v 0.01 2023/08/30 shanta Exp shanta ' %]
    <meta charset="utf-8">
    [% IF c.session.debug_mode == 1 %]
        [% PageVersion %]
    [% END %]
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="REVISIT-AFTER" content="7 days">
    <meta name="ROBOTS" content="index all, follow all">
    <meta charset="utf-8">
    [% # Make sure HostName is defined, use a default if not %]
    [% UNLESS HostName %]
        [% HostName = "http://" _ c.req.uri.host %]
        [% IF c.session.debug_mode == 1 %]
            <!-- Warning: HostName was not defined, using default: [% HostName %] -->
        [% END %]
    [% END %]
    <title>[% HostName _ ': ' _ ScriptDisplayName _ ': ' _ page_title %]</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="REVISIT-AFTER" content="7 days">
    <meta name="ROBOTS" content="index all, follow all">
    [% IF keywords %]
        <meta name="keywords" content="[% keywords %]">
    [% ELSE %]
        <meta name="keywords" content="[% data.http_header_keywords %]">
    [% END %]
    [% IF description %]
        <meta name="description" content="[% description %]">
    [% ELSE %]
        <meta name="description" content="[% http_header_description %]">
    [% END %]
    <link rel="shortcut icon" href="[% favicon | uri('imagesfavicon.ico') %]">
    [% IF SiteName == "CSC" %]
        [% embed('CSCWHMCSInterface') %]
    [% END %]

    <!-- Base CSS with variables -->
    <link rel="stylesheet" type="text/css" href="/static/css/base.css">

    <!-- Theme CSS - using JSON-based theme system -->
    [%
        # The theme_name should be set in the stash by the Root controller's set_theme method
        # But we'll add a fallback just in case

        # Default theme
        IF !theme_name;
            theme_name = 'default';

            # Set theme based on site name (lowercase)
            site_name_lower = SiteName | lower;

            # Check if we have a CSS file for this site
            IF site_name_lower == 'csc' || site_name_lower == 'apis' || site_name_lower == 'usbm';
                theme_name = site_name_lower;
            END;
        END;

        # Log the theme selection
        IF c.session.debug_mode == 1;
            c.log.info("Selected theme: " _ theme_name _ " for site: " _ SiteName);
            IF available_themes;
                c.log.info("Available themes: " _ available_themes.join(", "));
            END;
        END;
    %]
    <!-- Theme CSS: [% theme_name %] -->
    <link rel="stylesheet" type="text/css" href="/static/css/themes/[% theme_name %].css">

    <!-- Theme overrides to ensure proper application -->
    <link rel="stylesheet" type="text/css" href="/static/css/theme-overrides.css">

    <!-- Add theme class to body -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.body.classList.add('theme-[% theme_name %]');
        });
    </script>

    [% IF c.session.debug_mode == 1 %]
    <!-- Debug: Site name is [% SiteName %] -->
    [% END %]

    <!-- Site-specific CSS (for backward compatibility) -->
    <link rel="stylesheet" type="text/css" href="[% c.stash.css_view_name %]">
    <link rel="stylesheet" type="text/css" href="[% c.stash.log_css %]">
    <link rel="stylesheet" type="text/css" href="[% c.stash.menu_css %]">
    <link rel="stylesheet" type="text/css" href="[% c.stash.todo_css %]">

    <script src="static/js/sub-menu.js"></script>
    <script language="javascript" type="text/javascript">
        function switchpage(select) {
            var index;
            for (index = 0; index < select.options.length; index++) {
                if (select.options[index].selected) {
                    if (select.options[index].value !== "") {
                        window.location.href = select.options[index].value;
                        break;
                    }
                }
            }
        }
    </script>
</head>
