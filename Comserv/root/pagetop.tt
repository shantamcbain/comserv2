
[% PageVersion = 'pagetop.tt,v 0.022 2025/02/27 shanta Exp shanta ' %]
[%# PageVersion = 'pagetop.tt,v 0.02 2023/08/30 shanta Exp shanta ' %]

[% IF c.session.debug_mode == 1 %]
<div class="debug">
    [% PageVersion %]
    [% INCLUDE 'debug.tt' %]
    [% IF c.stash.debug_msg %]
        [% FOREACH msg IN c.stash.debug_msg %]
        <p class="debug">Debug: [% msg %]</p>
        [% END %]
    [% END %]
</div>
[% END %]

[% # Initialize roles if not defined
   SET c.session.roles = [] UNLESS c.session.roles.defined;
   SET roles = c.session.roles;
   SET is_admin = 0;
%]

[% IF roles && roles.size %]
    [% FOREACH role IN roles %]
        [% IF role == 'admin' %]
            [% SET is_admin = 1 %]
        [% END %]
    [% END %]
[% END %]


[% SET roles = c.session.roles || [] %]

<header>
    <h1>
        Welcome
        [% IF roles.grep('admin').size %]
            [% IF c.session.first_name.defined && c.session.last_name.defined %]
                [% c.session.first_name %] [% c.session.last_name %] (Administrator)
            [% ELSE %]
                Administrator
            [% END %]
        [% ELSIF roles.grep('user').size %]
            [% IF c.session.first_name.defined && c.session.last_name.defined %]
                [% c.session.first_name %] [% c.session.last_name %] (User)
            [% ELSE %]
                User
            [% END %]
        [% ELSE %]
            Guest
        [% END %]
        to [% c.stash.ScriptDisplayName || 'Default Site' %]!
    </h1>






    <!-- Main Menu -->
    <nav>
        <ul class="horizontal-menu">
            <li class="horizontal-dropdown">
                <a href="[% c.session.return_url || c.uri_for('/') %]" class="dropbtn">Back</a>
            </li>

            [% # Include navigation menus with error handling
               TRY %]
                [% INCLUDE 'Navigation/TopDropListMain.tt' %]
            [% CATCH %]
                <!-- Error including TopDropListMain.tt: [% error.info %] -->
            [% END %]

            [% TRY %]
                [% INCLUDE 'Navigation/TopDropListLogin.tt' %]
            [% CATCH %]
                <!-- Error including TopDropListLogin.tt: [% error.info %] -->
            [% END %]

            [% TRY %]
                [% INCLUDE 'Navigation/TopDropListGlobal.tt' %]
            [% CATCH %]
                <!-- Error including TopDropListGlobal.tt: [% error.info %] -->
            [% END %]

            [% TRY %]
                [% INCLUDE 'Navigation/TopDropListHosted.tt' %]
            [% CATCH %]
                <!-- Error including TopDropListHosted.tt: [% error.info %] -->
            [% END %]

            [% TRY %]
                [% INCLUDE 'Navigation/TopDropListMember.tt' %]
            [% CATCH %]
                <!-- Error including TopDropListMember.tt: [% error.info %] -->
            [% END %]

            [% # Include admin menu if user is an admin
               IF is_admin %]
                [% TRY %]
                    [% INCLUDE 'Navigation/admintopmenu.tt' %]
                [% CATCH %]
                    <!-- Error including admintopmenu.tt: [% error.info %] -->
                [% END %]
            [% END %]

            [% TRY %]
                [% INCLUDE 'Navigation/TopDropListHelpDesk.tt' %]
            [% CATCH %]
                <!-- Error including TopDropListHelpDesk.tt: [% error.info %] -->
            [% END %]
        </ul>
    </nav>
</header>
[% IF error_msg %]<div class="alert error">[% error_msg %]</div>[% END %]
[% IF success_msg %]<div class="alert success">[% success_msg %]</div>[% END %]
[% IF error_msg %]
<p class="error">Error: [% error_msg %]</p>
[% END %]

[% IF success_msg %]
<p class="success">Success: [% success_msg %]</p>
[% END %]