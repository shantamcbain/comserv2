[% META title = 'Project Details' %]
[% PageVersion = 'todo/projectdetails.tt,v 0.01 2024/03/15 shanta Exp shanta ' %]
[% IF debug_mode == 1 %]
        [% PageVersion %]
[% END %]

<h1>Project Details</h1>

<!-- Display the project details -->
<ul>
    <li>Name: [% project.name %]</li>
    <li>Description: [% project.description OR 'No description' %]</li>
    <li>Start Date: [% project.start_date %]</li>
    <li>End Date: [% project.end_date %]</li>
    <li>Status: [% project.status %]</li>
    <li>Parent ID: [% project.parent_id %]</li>
    <li>Project Code: [% project.project_code %]</li>
    <li>Project Size: [% project.project_size %]</li>
    <li>Estimated Man Hours: [% project.estimated_man_hours %]</li>
    <li>Developer Name: [% project.developer_name %]</li>
    <li>Client Name: [% project.client_name %]</li>
    <li>Site Name: [% project.sitename %]</li>
    <li>Comments: [% project.comments %]</li>
    <li>Username of Poster: [% project.username_of_poster %]</li>
    <li>Parent ID: [% project.parent_id %]</li>
    <li>Group of Poster: [% project.group_of_poster %]</li>
    <li>Date Time Posted: [% project.date_time_posted %]</li>
</ul>

<!-- List of Todos associated with the project with edit and log buttons -->
<h2>Todos for this Project</h2>
<ul>
    [% FOREACH todo IN todos %]
        <li>
            <strong>Subject:</strong> [% todo.subject %] <br>
            <strong>Description:</strong> [% todo.description OR 'No description' %] <br>
            <strong>Start Date:</strong> [% todo.start_date %] <br>
            <strong>Due Date:</strong> [% todo.due_date %] <br>
            <strong>Status:</strong> [% todo.status %] <br>
            <strong>Priority:</strong> [% todo.priority %]
            <!-- Add Edit and Log buttons -->
            <div class="todo-actions">
                <form action="/todo/details" method="POST" style="display: inline;">
                    <input type="hidden" name="record_id" value="[% todo.record_id %]">
                    <button type="submit">Edit Todo</button>
                </form>
                <form action="/log/log_form" method="POST" target="_blank" style="display: inline;">
                    <input type="hidden" name="record_id" value="[% todo.record_id %]">
                    <button type="submit">Add Log Entry</button>
                </form>
            </div>
            <!-- Display log entries for this todo -->
            [% IF todo.logs.size %]
                <div class="log-entries">
                    <h4>Log Entries:</h4>
                    <ul>
                        [% FOREACH log IN todo.logs %]
                            <li>
                                <strong>[% log.start_date %]:</strong> [% log.abstract %]
                                ([% log.time %] hours)
                            </li>
                        [% END %]
                    </ul>
                </div>
            [% END %]
        </li>
    [% END %]
</ul>

<!-- Button to go back to the project list -->
<button type="button" onclick="window.location.href='/project';">Back to Projects</button>

<!-- Form to edit the current project -->
<form action="/project/editproject" method="POST">
    <input type="hidden" name="project_id" value="[% project.id %]">
    <button type="submit">Edit Project [% project.id %]</button>
</form>
<!-- Button to add a sub-project for this project -->
<!-- This button redirects to the add_project page with the current project ID as the parent project -->
<form action="/project/addproject" method="GET">
    <input type="hidden" name="parent_id" value="[% project.id %]">
    <button type="submit">Add Sub-Project</button>
</form>

<!-- Button to add a new todo for this project -->
<!-- This button redirects to the addtodo page with the current project ID -->
<form action="/todo/addtodo" method="GET">
    <input type="hidden" name="project_id" value="[% project.id %]">
    <button type="submit">Add New Todo</button>
</form>
