[% META title = 'Project Details' %]
[% PageVersion = 'todo/projectdetails.tt,v 0.01 2024/03/15 shanta Exp shanta ' %]
[% IF debug_mode == 1 %]
    [% PageVersion %]
[% END %]

<h1>Project Details</h1>

<!-- Display the project details -->
<ul>
    <li>Name: [% project.name %]</li>
    <li>Description: [% project.description OR 'No description' %]</li>
    <li>Start Date: [% project.start_date %]</li>
    <li>End Date: [% project.end_date %]</li>
    <li>Status: [% project.status %]</li>
    <li>Parent ID: [% project.parent_id %]</li>
    <li>Project Code: [% project.project_code %]</li>
    <li>Project Size: [% project.project_size %]</li>
    <li>Estimated Man Hours: [% project.estimated_man_hours %]</li>
    <li>Developer Name: [% project.developer_name %]</li>
    <li>Client Name: [% project.client_name %]</li>
    <li>Site Name: [% project.sitename %]</li>
    <li>Comments: [% project.comments %]</li>
    <li>Username of Poster: [% project.username_of_poster %]</li>
    <li>Parent ID: [% project.parent_id %]</li>
    <li>Group of Poster: [% project.group_of_poster %]</li>
    <li>Date Time Posted: [% project.date_time_posted %]</li>
</ul>

<h2>Todos for this Project</h2>
<table class="project-details-table">
    <thead>
        <tr>
            <th>Subject</th>
            <th>Description</th>
            <th>Start Date</th>
            <th>Due Date</th>
            <th>Status</th>
            <th>Priority</th>
            <th>Accumulated Time</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        [% FOREACH todo IN todos %]
        <tr>
            <td>[% todo.subject %]</td>
            <td>[% todo.description OR 'No description' %]</td>
            <td>[% todo.start_date %]</td>
            <td>[% todo.due_date %]</td>
            <td>[% todo.status %]</td>
            <td>[% todo.priority %]</td>
            <td>[% todo.formatted_accumulated_time %]</td>
            <td>
                <!-- Button to edit the todo -->
                <form action="/todo/modify/[% todo.record_id %]" method="GET" style="display:inline;">
                    <button type="submit">Edit Todo</button>
                </form>
            </td>
        </tr>
        <tr>
            <td colspan="8">
                <strong>Log Entries:</strong>
                <ul>
                    [% FOREACH log IN todo.logs %]
                    <li>
                        Start: [% log.start_time %], End: [% log.end_time %], Time Spent: [% log.time_spent %]
                        <!-- Button to edit the log entry -->
                        <form action="/log/edit/[% log.id %]" method="GET" style="display:inline;">
                            <button type="submit">Edit Log</button>
                        </form>
                    </li>
                    [% END %]
                </ul>
            </td>
        </tr>
        [% END %]
    </tbody>
</table>

<!-- Display total accumulated time for the project -->
<h3>Total Accumulated Time for Project: [% total_accumulated_time %]</h3>

<!-- Button to go back to the project list -->
<button type="button" onclick="window.location.href='/project';">Back to Projects</button>

<!-- Form to edit the current project -->
<form action="/project/editproject" method="POST">
    <input type="hidden" name="project_id" value="[% project.id %]">
    <button type="submit">Edit Project [% project.id %]</button>
</form>

<!-- Button to add a sub-project for this project -->
<form action="/project/addproject" method="GET">
    <input type="hidden" name="parent_id" value="[% project.id %]">
    <button type="submit">Add Sub-Project</button>
</form>

<!-- Button to add a new todo for this project -->
<form action="/todo/addtodo" method="GET">
    <input type="hidden" name="project_id" value="[% project.id %]">
    <button type="submit">Add New Todo</button>
</form>
