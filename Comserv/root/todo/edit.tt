[% PageVersion  = 'todo/edit.tt,v 0.02 2025/04/01 Shanta Exp shanta'; %]
[% IF debug_mode == 1 %]
    [% PageVersion %]
[% END %]

<style>
    .form-container {
        max-width: 800px;
        margin: 0 auto;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }

    .form-group input[type="text"],
    .form-group input[type="date"],
    .form-group input[type="number"],
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .form-group textarea {
        min-height: 100px;
    }

    .action-buttons {
        margin: 20px 0;
        display: flex;
        gap: 10px;
    }

    .action-buttons button,
    .form-group input[type="submit"] {
        padding: 10px 15px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
    }

    .action-buttons button:hover,
    .form-group input[type="submit"]:hover {
        background-color: #45a049;
    }

    .return-button {
        background-color: #2196F3 !important;
    }

    .return-button:hover {
        background-color: #0b7dda !important;
    }

    .return-nav {
        margin-bottom: 20px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .return-nav a {
        padding: 8px 15px;
        background-color: #2196F3;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        text-decoration: none;
        display: inline-block;
    }

    .return-nav a:hover {
        background-color: #0b7dda;
    }
</style>

<div class="form-container">
    <h1>Edit Todo</h1>

    <!-- Display error message if there is one -->
    [% IF error_msg %]
        <div class="error-message">
            <p>[% error_msg %]</p>
        </div>
    [% END %]

    <!-- Display success message if there is one -->
    [% IF success_msg %]
        <div class="success-message">
            <p>[% success_msg %]</p>
        </div>
    [% END %]

    <!-- Return navigation buttons -->
    <div class="return-nav">
        <a href="/todo">Return to List View</a>
        <a href="/todo/day">Return to Day View</a>
        <a href="/todo/week">Return to Week View</a>
        <a href="/todo/month">Return to Month View</a>
        <button type="button" class="return-button" onclick="window.history.back();">Return to Previous Page</button>
    </div>
    
    <p>Record ID: [% record.get_column('record_id') %]</p>
    
    <!-- Display the accumulated time for the todo record -->
    <div class="form-group">
        <label for="accumulative_time_display">Accumulated Time:</label>
        <span id="accumulative_time_display">[% accumulative_time %]</span>
    </div>
    
    <form action="/todo/modify/[% record.get_column('record_id') %]" method="post">
        <div class="form-group">
            <label for="sitename">Site Name:</label>
            <input type="text" id="sitename" name="sitename" value="[% record.get_column('sitename') %]" required>
        </div>
        
        <div class="form-group">
            <label for="start_date">Start Date:</label>
            <input type="date" id="start_date" name="start_date" value="[% record.get_column('start_date') %]" required>
        </div>
        
        <div class="form-group">
            <label for="due_date">Due Date:</label>
            <input type="date" id="due_date" name="due_date" value="[% record.get_column('due_date') %]" required>
        </div>
        
        <div class="form-group">
            <label for="subject">Subject:</label>
            <input type="text" id="subject" name="subject" value="[% record.get_column('subject') %]" required>
        </div>
        
        <div class="form-group">
            <label for="description">Description:</label>
            <textarea id="description" name="description" required>[% record.get_column('description') %]</textarea>
        </div>
        
        <div class="form-group">
            <label for="estimated_man_hours">Estimated Man Hours:</label>
            <input type="number" id="estimated_man_hours" name="estimated_man_hours" value="[% record.get_column('estimated_man_hours') %]" required>
        </div>
        
        <div class="form-group">
            <label for="accumulative_time">Accumulative Time:</label>
            <input type="text" id="accumulative_time" name="accumulative_time" value="[% accumulative_time %]" readonly>
        </div>
        
        <div class="form-group">
            <label for="status">Status:</label>
            <select id="status" name="status" required>
                <option value="1" [% IF record.get_column('status') == 1 %]selected[% END %]>NEW</option>
                <option value="2" [% IF record.get_column('status') == 2 %]selected[% END %]>IN PROGRESS</option>
                <option value="3" [% IF record.get_column('status') == 3 %]selected[% END %]>DONE</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="priority">Priority:</label>
            <input type="number" id="priority" name="priority" value="[% record.get_column('priority') %]" min="1" max="10" required>
        </div>
        
        <div class="form-group">
            <label for="developer">Developer:</label>
            <input type="text" id="developer" name="developer" value="[% record.get_column('developer') %]">
        </div>
        
        <div class="form-group">
            <label for="owner">Owner:</label>
            <input type="text" id="owner" name="owner" value="[% record.get_column('owner') %]">
        </div>
        
        <div class="form-group">
            <label for="reporter">Reporter:</label>
            <input type="text" id="reporter" name="reporter" value="[% record.get_column('reporter') %]">
        </div>
        
        <div class="form-group">
            <label for="comments">Comments:</label>
            <textarea id="comments" name="comments">[% record.get_column('comments') %]</textarea>
        </div>
        
        <div class="form-group">
            <label for="project_id">Project:</label>
            <select id="project_id" name="project_id">
                <option value="">None</option>
                [% FOREACH project IN projects %]
                    <option value="[% project.id %]" [% IF record.get_column('project_id') == project.id %]selected[% END %]>[% project.name %]</option>
                    [% IF project.sub_projects.size > 0 %]
                        [% FOREACH sub_project IN project.sub_projects %]
                            <option value="[% sub_project.id %]" [% IF record.get_column('project_id') == sub_project.id %]selected[% END %]>&nbsp;&nbsp;- [% sub_project.name %]</option>
                            [% IF sub_project.sub_projects.size > 0 %]
                                [% FOREACH sub_sub_project IN sub_project.sub_projects %]
                                    <option value="[% sub_sub_project.id %]" [% IF record.get_column('project_id') == sub_sub_project.id %]selected[% END %]>&nbsp;&nbsp;&nbsp;&nbsp;-- [% sub_sub_project.name %]</option>
                                [% END %]
                            [% END %]
                        [% END %]
                    [% END %]
                [% END %]
            </select>
        </div>
        
        <div class="form-group">
            <label for="user_id">Assigned User:</label>
            <select id="user_id" name="user_id">
                <option value="">None</option>
                [% FOREACH user IN users %]
                    <option value="[% user.id %]" [% IF record.get_column('user_id') == user.id %]selected[% END %]>[% user.username %]</option>
                [% END %]
            </select>
        </div>
        
        <!-- Hidden fields to preserve data -->
        <input type="hidden" name="date_time_posted" value="[% record.get_column('date_time_posted') %]">
        <input type="hidden" name="username_of_poster" value="[% record.get_column('username_of_poster') %]">
        <input type="hidden" name="group_of_poster" value="[% record.get_column('group_of_poster') %]">
        <input type="hidden" name="share" value="[% record.get_column('share') %]">
        
        <div class="form-group">
            <input type="submit" value="Update Todo">
        </div>
    </form>
    
    <div class="action-buttons">
        <form action="/log/log_form" method="POST" target="_blank">
            <input type="hidden" name="todo_record_id" value="[% record.get_column('record_id') %]">
            <input type="hidden" name="site_name" value="[% record.get_column('sitename') %]">
            <input type="hidden" name="start_date" value="[% record.get_column('start_date') %]">
            <input type="hidden" name="due_date" value="[% record.get_column('due_date') %]">
            <input type="hidden" name="abstract" value="[% record.get_column('subject') %]">
            <input type="hidden" name="details" value="[% record.get_column('description') %]">
            <input type="hidden" name="priority" value="[% record.get_column('priority') %]">
            <input type="hidden" name="status" value="[% record.get_column('status') %]">
            <input type="hidden" name="comments" value="[% record.get_column('comments') %]">
            <button type="submit">Add Log Entry</button>
        </form>
    </div>
    
    <!-- Return navigation buttons -->
    <div class="return-nav">
        <a href="/todo">Return to List View</a>
        <a href="/todo/day">Return to Day View</a>
        <a href="/todo/week">Return to Week View</a>
        <a href="/todo/month">Return to Month View</a>
        <button type="button" class="return-button" onclick="window.history.back();">Return to Previous Page</button>
    </div>
</div>