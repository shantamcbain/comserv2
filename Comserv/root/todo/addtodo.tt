[% PageVersion = 'addtodo.tt,v 0.02 2023/11/28shanta Exp shanta ' %]
[% IF debug_mode == 1 %]
 [% PageVersion %]
[% END %]

<form action="/todo/create" method="post">

    <div>
        <label for="sitename">Site Name:</label>
        <input type="text" id="sitename" name="sitename" value="[% sitename OR '' %]">
    </div>

    <div>
        <label for="start_date">Start Date:</label>
        <input type="date" id="start_date" name="start_date" value="[% start_date OR '' %]">
    </div>

    <div>
        <label for="parent_id">Parent Project:</label><br>
        <select id="parent_id" name="parent_id" onchange="document.getElementById('manual_project_id').value = this.value;">
            <option value="">None</option>
            <!-- Include the project list as options -->
            [% FOREACH project IN projects %]
                [% IF !project.parent_id %]
                    <option value="[% project.id %]" [% IF project.id == project_id %]selected[% END %]>[% project.name %]</option>
                    <!-- Display the list of sub-projects -->
                    [% IF project.sub_projects.size %]
                        [% FOREACH sub_project IN project.sub_projects %]
                            <option value="[% sub_project.id %]" [% IF sub_project.id == project_id %]selected[% END %]>--- [% sub_project.name %]</option>
                        [% END %]
                    [% END %]
                [% END %]
            [% END %]
        </select><br>
    </div>

    <div>
        <label for="manual_project_id">Manual Project ID:</label>
        <input type="text" id="manual_project_id" name="manual_project_id" value="[% project_id OR '' %]">
    </div>

    <div>
        <label for="due_date">Due Date:</label>
        <input type="date" id="due_date" name="due_date" value="[% todo.due_date OR '' %]">
    </div>

    <div>
        <label for="subject">Subject:</label>
        <input type="text" id="subject" name="subject" value="[% todo.subject OR '' %]">
    </div>

    <div>
        <label for="description">Description:</label>
        <textarea id="description" name="description">[% todo.description OR '' %]</textarea>
    </div>

    <div>
        <label for="estimated_man_hours">Estimated Man Hours:</label>
        <select id="estimated_man_hours" name="estimated_man_hours">
            [% FOREACH hour IN [1..100] %]
                <option value="[% hour %]" [% IF hour == todo.estimated_man_hours %]selected[% END %]>[% hour %]</option>
            [% END %]
        </select>
    </div>

    <div>
        <label for="accumulative_time">Accumulative Time:</label>
        <input type="number" id="accumulative_time" name="accumulative_time" value="[% todo.accumulative_time OR '' %]">
    </div>

    <div>
        <label for="status">Status:</label>
        <select id="status" name="status">
            <option value="1" [% IF todo.status == 'NEW' %]selected[% END %]>NEW</option>
            <option value="2" [% IF todo.status == 'IN PROGRESS' %]selected[% END %]>IN PROGRESS</option>
            <option value="3" [% IF todo.status == 'DONE' %]selected[% END %]>DONE</option>
        </select>
    </div>

    <div>
        <label for="priority">Priority:</label>
        <select id="priority" name="priority">
            [% FOREACH priority IN [1..10] %]
                <option value="[% priority %]" [% IF priority == todo.priority %]selected[% END %]>[% priority %]</option>
            [% END %]
        </select>
    </div>

    <div>
        <label for="share">Share:</label>
        <select id="share" name="share">
            <option value="0" [% IF todo.share == 'public' %]selected[% END %]>Public</option>
            <option value="1" [% IF todo.share == 'private' %]selected[% END %]>Private</option>
        </select>
    </div>

    <div>
        <label for="last_mod_by">Last Modified By:</label>
        <input type="text" id="last_mod_by" name="last_mod_by" value="[% todo.last_mod_by OR '' %]">
    </div>

    <div>
        <label for="last_mod_date">Last Modified Date:</label>
        <input type="date" id="last_mod_date" name="last_mod_date" value="[% todo.last_mod_date OR '' %]">
    </div>

    <div>
        <label for="group_of_poster">Group of Poster:</label>
        <input type="text" id="group_of_poster" name="group_of_poster" value="[% todo.group_of_poster || session.group_of_poster || 'default_group' %]">
    </div>

    <div>
        <label for="user_id">User ID:</label>
        <select id="user_id" name="user_id">
            [% FOREACH user IN users %]
                <option value="[% user.id %]" [% IF user.id == todo.user_id %]selected[% END %]>[% user.username %]</option>
            [% END %]
        </select>
    </div>

    <div>
        <input type="submit" value="Submit">
    </div>
</form>
