[% PageVersion = 'Comserv/root/Documentation/general/THEME_SYSTEM_README.tt,v 0.01 2025/06/10 shanta Exp shanta ' %]
[% IF c.session.debug_mode == 1 %]
    [% PageVersion %]
[% END %]

[% META title = 'Theme System README' %]

<!-- Documentation page for THEME_SYSTEM_README -->
<div class="documentation-content">




<!-- Documentation CSS is now included in the theme system -->

<div class="markdown-content">


<h2>Overview</h2>



This document provides instructions for fixing and maintaining the theme system in the Comserv application.



<h2>Recent Fixes</h2>



We've made the following improvements to the theme system:



<ol><li>Updated the <code>theme_definitions.json</code> file to include all the original themes (default, csc, apis, usbm, dark)</li></ol>

<ol><li>Enhanced the ThemeManager's <code>get_all_themes</code> method to load themes from the theme_definitions.json file</li></ol>

<ol><li>Improved the <code>validate_theme</code> method to be more lenient with theme names</li></ol>

<ol><li>Created a script to generate CSS files for all themes</li></ol>



<h2>How to Fix Missing Themes</h2>



If you notice that some themes are missing from the theme selection dropdown, follow these steps:



<ol><li>Make sure the <code>theme_definitions.json</code> file contains all the required themes:</li></ol>

   <code></code>`

   /comserv/Comserv/root/static/config/theme_definitions.json

   <code></code>`



<ol><li>Make sure the <code>theme_mappings.json</code> file contains the correct mappings:</li></ol>

   <code></code>`

   /comserv/Comserv/root/static/config/theme_mappings.json

   <code></code>`



<ol><li>Run the script to generate CSS files for all themes:</li></ol>

   <code></code>`

   cd /comserv/Comserv

   perl script/generate_theme_css.pl

   <code></code>`



<ol><li>Restart the application to apply the changes.</li></ol>



<h2>Theme System Architecture</h2>



The theme system consists of the following components:



<ol><li>**Theme Definitions**: JSON file that defines all available themes and their properties</li></ol>

   - Located at <code>/comserv/Comserv/root/static/config/theme_definitions.json</code>



<ol><li>**Theme Mappings**: JSON file that maps sites to themes</li></ol>

   - Located at <code>/comserv/Comserv/root/static/config/theme_mappings.json</code>



<ol><li>**CSS Files**: CSS files for each theme</li></ol>

   - Located in <code>/comserv/Comserv/root/static/css/themes/</code> directory



<ol><li>**ThemeManager**: Perl module that manages themes</li></ol>

   - Located at <code>/comserv/Comserv/lib/Comserv/Util/ThemeManager.pm</code>



<ol><li>**Theme Controller**: Controller for the theme management interface</li></ol>

   - Located at <code>/comserv/Comserv/lib/Comserv/Controller/Admin/Theme.pm</code>



<h2>Adding a New Theme</h2>



To add a new theme:



<ol><li>Add the theme definition to <code>theme_definitions.json</code></li></ol>

<ol><li>Run the <code>generate_theme_css.pl</code> script to generate the CSS file</li></ol>

<ol><li>Restart the application</li></ol>



<h2>Troubleshooting</h2>



If you encounter issues with the theme system:



<ol><li>Check the application logs for errors</li></ol>

<ol><li>Verify that all theme files exist and have the correct permissions</li></ol>

<ol><li>Make sure the JSON files are valid and contain all required themes</li></ol>

<ol><li>Run the <code>generate_theme_css.pl</code> script to regenerate all theme CSS files</li></ol>



<h2>Permissions</h2>



Make sure the following files and directories have the correct permissions:



<ol><li><code>/comserv/Comserv/root/static/config/theme_definitions.json</code> (readable by the web server)</li></ol>

<ol><li><code>/comserv/Comserv/root/static/config/theme_mappings.json</code> (readable and writable by the web server)</li></ol>

<ol><li><code>/comserv/Comserv/root/static/css/themes/</code> directory (readable and writable by the web server)</li></ol>



You can use the following command to set the correct permissions:



<code></code>`

chmod 664 /comserv/Comserv/root/static/config/theme_*.json

chmod 775 /comserv/Comserv/root/static/css/themes/

<code></code>`

</div>
