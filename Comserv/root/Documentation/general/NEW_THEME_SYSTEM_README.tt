[% PageVersion = 'Comserv/root/Documentation/general/NEW_THEME_SYSTEM_README.tt,v 0.01 2025/06/10 shanta Exp shanta ' %]
[% IF c.session.debug_mode == 1 %]
    [% PageVersion %]
[% END %]

[% META title = 'New Theme System' %]

<!-- Documentation page for NEW_THEME_SYSTEM_README -->
<div class="documentation-content">




<!-- Documentation CSS is now included in the theme system -->

<div class="markdown-content">


<h2>Overview</h2>



The theme system has been refactored to follow a cleaner MVC pattern with centralized functionality. This makes the code more maintainable, reduces duplication, and provides a clear structure for future enhancements.



<h2>Components</h2>



<h3>1. Model</h3>



**<code>Comserv::Model::Theme</code>** - Central model for all theme-related data operations:

<ul><li>Loading and saving theme definitions</li></ul>

<ul><li>Managing theme mappings</li></ul>

<ul><li>Generating CSS files</li></ul>

<ul><li>Theme validation</li></ul>



<h3>2. Controller</h3>



**<code>Comserv::Controller::Admin::Theme</code>** - Unified controller for all theme-related actions:

<ul><li>Theme selection</li></ul>

<ul><li>Theme editing</li></ul>

<ul><li>CSS generation</li></ul>

<ul><li>Theme preview</li></ul>

<ul><li>Legacy URL redirection</li></ul>



<h3>3. Utilities</h3>



**<code>Comserv::Util::ThemeUtils</code>** - Helper functions for theme operations:

<ul><li>CSS variable extraction</li></ul>

<ul><li>Theme validation</li></ul>

<ul><li>CSS generation helpers</li></ul>

<ul><li>Preview generation</li></ul>



<h3>4. Configuration Files</h3>



All theme configuration is stored in a single location:

<ul><li><code>/comserv/Comserv/root/static/config/theme_definitions.json</code> - All theme definitions</li></ul>

<ul><li><code>/comserv/Comserv/root/static/config/theme_mappings.json</code> - Site to theme mappings</li></ul>



<h3>5. CSS Files</h3>



Theme CSS files are generated and stored in:

<ul><li><code>/comserv/Comserv/root/static/css/themes/</code></li></ul>



<h3>6. Templates</h3>



All theme-related templates are in:

<ul><li><code>/comserv/Comserv/root/admin/theme/</code></li></ul>



<h2>How to Use the Theme System</h2>



<h3>Setting a Theme for a Site</h3>



<code></code>`perl

$c->model('Theme')->set_site_theme($c, $site_name, $theme_name);

<code></code>`



<h3>Getting a Site's Theme</h3>



<code></code>`perl

my $theme = $c->model('Theme')->get_site_theme($c, $site_name);

<code></code>`



<h3>Creating a New Theme</h3>



<code></code>`perl

my $theme_data = {

    name => "Theme Name",

    description => "Theme Description",

    variables => {

        "primary-color" => "#ffffff",

        "secondary-color" => "#f9f9f9",

        # ... other variables

    }

};



$c->model('Theme')->create_theme($c, $theme_name, $theme_data);

<code></code>`



<h3>Generating CSS Files</h3>



<code></code>`perl

$c->model('Theme')->generate_all_theme_css($c);

<code></code>`



<h2>Theme Definition Structure</h2>



Each theme is defined in the <code>theme_definitions.json</code> file with the following structure:



<code></code>`json

{

  "theme_name": {

    "name": "Display Name",

    "description": "Theme description",

    "variables": {

      "primary-color": "#ffffff",

      "secondary-color": "#f9f9f9",

      "accent-color": "#FF9900",

      "text-color": "#000000",

      "link-color": "#0000FF",

      "link-hover-color": "#000099",

      "background-color": "#ffffff",

      "border-color": "#dddddd",

      "table-header-bg": "#f2f2f2",

      "warning-color": "#f39c12",

      "success-color": "#27ae60"

    },

    "special_styles": {

      "body": "background-image: url('../images/pattern.jpg');"

    }

  }

}

<code></code>`



<h2>Theme Mapping Structure</h2>



Site to theme mappings are stored in the <code>theme_mappings.json</code> file:



<code></code>`json

{

  "sites": {

    "SiteName1": "theme_name1",

    "SiteName2": "theme_name2"

  }

}

<code></code>`



<h2>Backward Compatibility</h2>



The new theme system includes a legacy URL redirection mechanism to ensure backward compatibility with existing links:



<ul><li><code>/themeadmin</code> → <code>/admin/theme</code></li></ul>

<ul><li><code>/themeadmin/update_theme</code> → <code>/admin/theme/update</code></li></ul>

<ul><li><code>/themeadmin/edit_theme_css/[theme]</code> → <code>/admin/theme/edit/[theme]</code></li></ul>

<ul><li><code>/themeadmin/wysiwyg_editor/[theme]</code> → <code>/admin/theme/edit/[theme]</code></li></ul>



<h2>Future Enhancements</h2>



Planned enhancements for the theme system:



<ol><li>Theme import/export functionality</li></ol>

<ol><li>Visual theme editor with live preview</li></ol>

<ol><li>Theme inheritance for creating derived themes</li></ol>

<ol><li>User-specific theme preferences</li></ol>

</div>
