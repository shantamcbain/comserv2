[% PageVersion = 'Comserv/root/Documentation/developer/template_system.tt,v 0.01 2025/06/10 shanta Exp shanta ' %]
[% IF c.session.debug_mode == 1 %]
    [% PageVersion %]
[% END %]

[% META title = 'Template System Documentation' %]

<!-- Documentation page for template_system -->
<div class="documentation-content">



<!-- Include documentation CSS -->
<link rel="stylesheet" href="/static/css/documentation.css">

<div class="markdown-content">


**File:** /home/shanta/PycharmProjects/comserv/Comserv/root/Documentation/developer/template_system.md  

**Version:** 1.0  

**Last Updated:** May 31, 2024  

**Author:** Development Team



<h2>Overview</h2>



The Comserv application uses the Template Toolkit (TT) system for rendering views. This document provides comprehensive information about the template structure, includes, variables, and best practices for working with templates in the application.



<h2>Template Structure</h2>



<h3>Directory Organization</h3>



Templates are organized in the following directory structure:



<code></code>`

Comserv/root/

├── layout.tt           # Main layout template

├── pagetop.tt          # Top navigation and header

├── footer.tt           # Footer content

├── AdminNotes.tt       # Admin-specific notes

├── debug.tt            # Debug information

├── Navigation/         # Navigation components

│   ├── TopDropListMain.tt

│   ├── TopDropListLogin.tt

│   ├── TopDropListGlobal.tt

│   ├── TopDropListHosted.tt

│   ├── TopDropListMember.tt

│   ├── admintopmenu.tt

│   └── TopDropListHelpDesk.tt

├── user/               # User-related templates

│   ├── login.tt

│   ├── profile.tt

│   ├── settings.tt

│   └── create_account.tt

└── Documentation/      # Documentation templates

    ├── index.tt

    ├── roles/

    ├── sites/

    └── ...

<code></code>`



<h3>Template Hierarchy</h3>



The template rendering follows this hierarchy:



<ol><li><code>layout.tt</code> - Main container template</li></ol>

<ol><li><code>pagetop.tt</code> - Header and navigation</li></ol>

<ol><li>Content-specific template (e.g., <code>user/profile.tt</code>)</li></ol>

<ol><li><code>AdminNotes.tt</code> - Administrative notes</li></ol>

<ol><li><code>footer.tt</code> - Footer content</li></ol>



<h2>Main Layout Template</h2>



The <code>layout.tt</code> file serves as the main container for all pages:



<code></code>`html

<!DOCTYPE html>

<html>

    [% INCLUDE 'Header.tt' %]

<body class="theme-[% theme_name || c.stash.theme_name || c.session.theme_name || 'default' %]">

    [% INCLUDE 'pagetop.tt' %]

    [% content %]

    [% INCLUDE 'AdminNotes.tt' %]

    [% TRY %]

        [% INCLUDE 'footer.tt' %]

    [% CATCH %]

        <!-- Fallback footer -->

        <footer>

            <div class="footer-content">

                <p>&copy; [% USE date; date.format(date.now, '%Y') %] Comserv. All rights reserved.</p>



                    <p><a href="[% c.uri_for('/reset_session') %]">Reset Session</a></p>



        </footer>


</body>

</html>

<code></code>`



Key features:

<ul><li>Dynamic theme selection based on user preferences</li></ul>

<ul><li>Content placeholder for page-specific content</li></ul>

<ul><li>Error handling for footer inclusion</li></ul>

<ul><li>Debug information display when in debug mode</li></ul>



<h2>Common Template Components</h2>



<h3>Page Header (<code>pagetop.tt</code>)</h3>



The <code>pagetop.tt</code> file contains:

<ul><li>Debug information (when debug mode is enabled)</li></ul>

<ul><li>Welcome message with user information</li></ul>

<ul><li>Main navigation menu</li></ul>

<ul><li>Error and success message display</li></ul>



<code></code>`html


<div class="debug">


    [% INCLUDE 'debug.tt' %]





<header>

    <h1>

        Welcome [% IF roles.grep('admin').size %]

            [% c.session.first_name %] [% c.session.last_name %] Administrator

        [% ELSIF roles.grep('user').size %]

            <p> [% c.session.first_name %] [% c.session.last_name %] User

        [% ELSE %]

            <p> Guest


    </h1>



    <!-- Main Menu -->

    <nav>

        <ul class="horizontal-menu">

            <!-- Navigation items -->

        </ul>

    </nav>

</header>





<code></code>`



<h3>Navigation Components</h3>



Navigation is modularized into separate components:



<ul><li><code>TopDropListMain.tt</code> - Main site navigation</li></ul>

<ul><li><code>TopDropListLogin.tt</code> - Login/logout and user account options</li></ul>

<ul><li><code>TopDropListGlobal.tt</code> - Global site links</li></ul>

<ul><li><code>admintopmenu.tt</code> - Admin-specific navigation</li></ul>



Example of the login dropdown (<code>TopDropListLogin.tt</code>):



<code></code>`html

<li class="horizontal-dropdown">

    [% IF c.session.username %]

        <!-- User is logged in -->

        <a href="#" class="dropbtn">[% c.session.username %]</a>

        <div class="dropdown-content">

            <a href="[% c.uri_for('/user/profile') %]">My Profile</a>

            <a href="[% c.uri_for('/user/settings') %]">Account Settings</a>


            <a href="[% c.uri_for('/user/logout') %]">Logout</a>


    [% ELSE %]

        <!-- User is not logged in -->

        <a href="[% c.uri_for('/user/login') %]" class="dropbtn">Login</a>

        <div class="dropdown-content">

            <a href="[% c.uri_for('/user/login') %]">Login</a>

            <a href="[% c.uri_for('/user/create_account') %]">Register</a>

            <a href="[% c.uri_for('/user/forgot_password') %]">Forgot Password</a>



</li>

<code></code>`



<h3>Footer (<code>footer.tt</code>)</h3>



The footer contains:

<ul><li>Copyright information</li></ul>

<ul><li>Debug information (when in debug mode)</li></ul>

<ul><li>Session reset link (when in debug mode)</li></ul>

<ul><li>Live chat integration</li></ul>



<h2>Template Variables</h2>



<h3>Common Variables</h3>



| Variable | Description | Source |

|----------|-------------|--------|

| <code>c.session.username</code> | Current user's username | Session |

| <code>c.session.first_name</code> | User's first name | Session |

| <code>c.session.last_name</code> | User's last name | Session |

| <code>c.session.roles</code> | Array of user roles | Session |

| <code>c.session.debug_mode</code> | Debug mode flag (0 or 1) | Session |

| <code>c.session.theme_name</code> | User's theme preference | Session |

| <code>c.stash.ScriptDisplayName</code> | Current site display name | Stash |

| <code>error_msg</code> | Error message to display | Stash/Flash |

| <code>success_msg</code> | Success message to display | Stash/Flash |

| <code>PageVersion</code> | Template version information | Template |



<h3>Accessing Session Data</h3>



Session data can be accessed using the <code>c.session</code> object:



<code></code>`html

[% IF c.session.username %]

    Welcome back, [% c.session.first_name %]!


<code></code>`



<h3>Stash Variables</h3>



The stash contains variables set by the controller:



<code></code>`html

[% IF c.stash.debug_msg.defined && c.stash.debug_msg.size > 0 %]

    <div class="debug-messages">

        <h4>Debug Messages</h4>

        [% FOREACH msg IN c.stash.debug_msg %]

            <p class="debug">Debug [% loop.index %]: [% msg %]</p>




<code></code>`



<h2>Template Directives</h2>



<h3>Includes</h3>



Include other templates:



<code></code>`html

[% INCLUDE 'Navigation/TopDropListMain.tt' %]

<code></code>`



<h3>Conditionals</h3>



Check conditions:



<code></code>`html

[% IF c.session.roles.grep('admin').size %]

    <!-- Admin content -->

[% ELSIF c.session.username %]

    <!-- Logged-in user content -->

[% ELSE %]

    <!-- Guest content -->


<code></code>`



<h3>Loops</h3>



Iterate through collections:



<code></code>`html

[% FOREACH role IN c.session.roles %]

    <span class="role-badge">[% role %]</span>


<code></code>`



<h3>Error Handling</h3>



Handle template errors:



<code></code>`html

[% TRY %]

    [% INCLUDE 'some_template.tt' %]

[% CATCH %]

    <!-- Error fallback -->

    <p>Error: [% error.info %]</p>


<code></code>`



<h2>Debug Mode</h2>



Debug mode provides additional information for developers:



<ol><li>Enable debug mode in user settings or set <code>$c->session->{debug_mode} = 1;</code> in code</li></ol>

<ol><li>Debug information is displayed at the top of the page</li></ol>

<ol><li>Template versions are shown</li></ol>

<ol><li>Session reset link is available</li></ol>



Debug output example:



<code></code>`html

<div class="debug">

    pagetop.tt,v 0.022 2025/02/27 shanta Exp shanta

    <!-- Additional debug information -->


<code></code>`



<h2>Best Practices</h2>



<h3>1. Template Versioning</h3>



Include version information at the top of each template:



<code></code>`html





<code></code>`



<h3>2. URI Generation</h3>



Always use <code>c.uri_for()</code> to generate URLs:



<code></code>`html

<a href="[% c.uri_for('/user/profile') %]">My Profile</a>

<code></code>`



<h3>3. Error Handling</h3>



Use TRY/CATCH blocks for potentially problematic includes:



<code></code>`html

[% TRY %]

    [% INCLUDE 'template.tt' %]

[% CATCH %]

    <!-- Fallback content -->


<code></code>`



<h3>4. Conditional Display</h3>



Check for variable existence before using:



<code></code>`html

[% IF variable.defined %]

    [% variable %]

[% ELSE %]

    Default value


<code></code>`



<h3>5. Modularization</h3>



Break complex templates into smaller, reusable components:



<code></code>`html

[% INCLUDE 'components/user_card.tt' user=current_user %]

<code></code>`



<h2>Troubleshooting</h2>



<h3>Common Template Issues</h3>



<ol><li>**Missing Variables**</li></ol>

   - Symptom: Empty content or "[% variable %]" displayed

   - Solution: Ensure the variable is set in the controller



<ol><li>**Template Not Found**</li></ol>

   - Symptom: "file error - template.tt: not found" error

   - Solution: Check the path and ensure the file exists



<ol><li>**Syntax Errors**</li></ol>

   - Symptom: "parse error - template.tt line X: unexpected token" error

   - Solution: Check TT syntax, especially unclosed tags or quotes



<h3>Debugging Templates</h3>



<ol><li>Enable debug mode to see template versions and paths</li></ol>

<ol><li>Use <code>[% DUMP variable %]</code> to inspect variable contents</li></ol>

<ol><li>Check the Catalyst debug output for template processing information</li></ol>

<ol><li>Review the application log for template-related errors</li></ol>



<h2>Extending the Template System</h2>



<h3>Adding New Templates</h3>



<ol><li>Create the template file in the appropriate directory</li></ol>

<ol><li>Use the standard header with version information</li></ol>

<ol><li>Include necessary components and styling</li></ol>

<ol><li>Reference the template in your controller:</li></ol>



<code></code>`perl

$c->stash(template => 'path/to/template.tt');

$c->forward($c->view('TT'));

<code></code>`



<h3>Custom Template Plugins</h3>



To add custom TT plugins:



<ol><li>Create a plugin in <code>lib/Template/Plugin/YourPlugin.pm</code></li></ol>

<ol><li>Configure the plugin in your TT view configuration</li></ol>

<ol><li>Use the plugin in templates: <code>[% USE YourPlugin %]</code></li></ol>



<h2>Template Performance Considerations</h2>



<ol><li>**Caching**: Templates are cached by default for performance</li></ol>

<ol><li>**Complexity**: Avoid deeply nested includes and complex logic</li></ol>

<ol><li>**Inline CSS/JS**: Consider moving inline styles to external files</li></ol>

<ol><li>**Large Templates**: Break large templates into smaller components</li></ol>

</div>
