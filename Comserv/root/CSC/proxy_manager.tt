[% META title = 'Proxy Manager' %]

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="page-header">Nginx Proxy Manager</h1>
            <p class="lead">Manage proxy configurations for your applications and services.</p>
            
            [% IF development_notice %]
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> <strong>Development Mode:</strong> [% development_notice | html %]
                    
                    [% IF show_docker_install_button %]
                        <div class="mt-3">
                            <a href="[% c.uri_for('/proxymanager/install_docker') %]" class="btn btn-primary">
                                <i class="fas fa-download"></i> Install Docker
                            </a>
                        </div>
                    [% END %]
                </div>
            [% END %]
            
            [% IF api_warning %]
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i> <strong>Warning:</strong> [% api_warning | html %]
                </div>
            [% END %]
            
            [% IF show_docker_install_button %]
                <div class="alert alert-danger">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h4 class="alert-heading"><i class="fas fa-exclamation-circle"></i> Docker Not Installed</h4>
                            <p>Docker is required to run Nginx Proxy Manager. Please install Docker to continue.</p>
                        </div>
                        <div>
                            <a href="[% c.uri_for('/proxymanager/install_docker') %]" class="btn btn-danger btn-lg">
                                <i class="fas fa-download"></i> Install Docker
                            </a>
                        </div>
                    </div>
                </div>
            [% END %]
        </div>
    </div>
    
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">Environment Information</h5>
                </div>
                <div class="card-body">
                    <table class="table table-sm">
                        <tbody>
                            <tr>
                                <th>Environment:</th>
                                <td>
                                    [% IF environment == 'production' %]
                                        <span class="badge badge-danger">Production</span>
                                    [% ELSIF environment == 'staging' %]
                                        <span class="badge badge-warning">Staging</span>
                                    [% ELSE %]
                                        <span class="badge badge-info">Development</span>
                                    [% END %]
                                </td>
                            </tr>
                            <tr>
                                <th>Access Scope:</th>
                                <td>
                                    [% IF access_scope == 'read-only' %]
                                        <span class="badge badge-secondary">Read-Only</span>
                                    [% ELSIF access_scope == 'localhost-only' %]
                                        <span class="badge badge-warning">Localhost Only</span>
                                    [% ELSE %]
                                        <span class="badge badge-success">Full Access</span>
                                    [% END %]
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">Actions</h5>
                </div>
                <div class="card-body">
                    <a href="[% c.uri_for('/proxymanager/create_proxy') %]" class="btn btn-success">
                        <i class="fas fa-plus"></i> Create New Proxy
                    </a>
                    
                    <a href="[% c.uri_for('/proxymanager/setup_infrastructure') %]" class="btn btn-info ml-2">
                        <i class="fas fa-cogs"></i> Infrastructure Setup
                    </a>
                    
                    [% IF npm_admin_url %]
                        <a href="[% npm_admin_url %]" target="_blank" class="btn btn-outline-primary ml-2">
                            <i class="fas fa-external-link-alt"></i> NPM Admin UI
                        </a>
                    [% END %]
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">Proxy Hosts</h5>
                </div>
                <div class="card-body">
                    [% IF proxies.data.size > 0 %]
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Domain Names</th>
                                        <th>Forward Target</th>
                                        <th>Created</th>
                                        <th>Modified</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    [% FOREACH proxy IN proxies.data %]
                                        <tr>
                                            <td>[% proxy.id | html %]</td>
                                            <td>
                                                [% FOREACH domain IN proxy.domain_names %]
                                                    <span class="badge badge-primary">[% domain | html %]</span>
                                                [% END %]
                                            </td>
                                            <td>
                                                <code>[% proxy.forward_scheme | html %]://[% proxy.forward_host | html %]:[% proxy.forward_port | html %]</code>
                                            </td>
                                            <td>[% proxy.created_on | html %]</td>
                                            <td>[% proxy.modified_on | html %]</td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <a href="[% c.uri_for('/proxymanager/edit_proxy', proxy.id) %]" class="btn btn-outline-primary">
                                                        <i class="fas fa-edit"></i>
                                                    </a>
                                                    <a href="[% c.uri_for('/proxymanager/delete_proxy', proxy.id) %]" class="btn btn-outline-danger delete-proxy" data-id="[% proxy.id | html %]">
                                                        <i class="fas fa-trash"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    [% END %]
                                </tbody>
                            </table>
                        </div>
                    [% ELSE %]
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> No proxy hosts found. Click "Create New Proxy" to add one.
                        </div>
                    [% END %]
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteProxyModal" tabindex="-1" role="dialog" aria-labelledby="deleteProxyModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteProxyModalLabel">Confirm Deletion</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this proxy host? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <a href="#" id="confirmDelete" class="btn btn-danger">Delete</a>
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    // Handle delete confirmation
    $('.delete-proxy').click(function(e) {
        e.preventDefault();
        var proxyId = $(this).data('id');
        var deleteUrl = $(this).attr('href');
        
        $('#confirmDelete').attr('href', deleteUrl);
        $('#deleteProxyModal').modal('show');
    });
});
</script>