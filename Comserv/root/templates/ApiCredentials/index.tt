[% META title = 'API Credentials Management' %]

<div class="api-credentials-container">
    <h1>API Credentials Management</h1>
    
    [% IF success_message %]
    <div class="alert alert-success">
        [% success_message %]
    </div>
    [% END %]
    
    [% IF error_message %]
    <div class="alert alert-danger">
        [% error_message %]
    </div>
    [% END %]
    
    <div class="description">
        <p>This page allows administrators to manage API credentials for various services used by the system.</p>
        <p>Please ensure that you keep these credentials secure and only share them with authorized personnel.</p>
    </div>
    
    <form method="POST" action="[% c.uri_for('/ApiCredentials/update') %]">
        <!-- Cloudflare Section -->
        <div class="service-section">
            <h2>Cloudflare</h2>
            <div class="service-description">
                <p>Cloudflare provides DNS, CDN, and security services for websites.</p>
                <p>The API token is used to authenticate requests to the Cloudflare API.</p>
                <p>The application ID is used to identify your application when making API requests.</p>
                <p>Learn more: <a href="https://developers.cloudflare.com/api" target="_blank">Cloudflare API Documentation</a></p>
            </div>
            
            <div class="service-fields">
                <div class="form-group">
                    <label for="cloudflare_api_token">API Token</label>
                    <div class="field-description">Used for authentication with the Cloudflare API</div>
                    <input type="password" class="form-control" id="cloudflare_api_token" name="cloudflare_api_token" value="[% credentials.cloudflare.api_token | html %]">
                    <button type="button" class="toggle-password" data-target="cloudflare_api_token">Show</button>
                </div>
                
                <div class="form-group">
                    <label for="cloudflare_application_id">Application ID</label>
                    <div class="field-description">
                        <strong>What is the Application ID?</strong> This is a unique identifier for your application in Cloudflare's system. It's required for API authentication and rate limiting.
                    </div>
                    <input type="text" class="form-control" id="cloudflare_application_id" name="cloudflare_application_id" value="[% credentials.cloudflare.application_id | html %]">
                    
                    <div class="help-box">
                        <h4>How to Find Your Cloudflare Application ID</h4>
                        <div class="help-content">
                            <div class="method">
                                <h5>Method 1: From the API Tokens Page</h5>
                                <ol>
                                    <li>Log in to your <a href="https://dash.cloudflare.com" target="_blank">Cloudflare Dashboard</a></li>
                                    <li>Click on your profile icon in the top-right corner</li>
                                    <li>Select <strong>"My Profile"</strong> from the dropdown menu</li>
                                    <li>In the left sidebar, click on <strong>"API Tokens"</strong></li>
                                    <li>Look at the top of the page for your <strong>"Account ID"</strong> - this is your Application ID</li>
                                </ol>
                                <div class="visual-cue">
                                    <span class="icon">üîç</span> Look for a string like: <code>a1b2c3d4e5f6g7h8i9j0</code>
                                </div>
                            </div>
                            
                            <div class="method">
                                <h5>Method 2: From the Developer Documentation</h5>
                                <ol>
                                    <li>Log in to your <a href="https://dash.cloudflare.com" target="_blank">Cloudflare Dashboard</a></li>
                                    <li>Click on <strong>"Workers & Pages"</strong> in the sidebar</li>
                                    <li>Click on <strong>"Overview"</strong></li>
                                    <li>Scroll down to find your <strong>"Account ID"</strong> - this is your Application ID</li>
                                </ol>
                            </div>
                            
                            <div class="method">
                                <h5>Method 3: From the URL</h5>
                                <ol>
                                    <li>Log in to your <a href="https://dash.cloudflare.com" target="_blank">Cloudflare Dashboard</a></li>
                                    <li>Go to any page in your account</li>
                                    <li>Look at the URL in your browser's address bar</li>
                                    <li>Find the segment that looks like: <code>https://dash.cloudflare.com/<strong>a1b2c3d4e5f6g7h8i9j0</strong>/...</code></li>
                                    <li>The highlighted part is your Application ID</li>
                                </ol>
                            </div>
                            
                            <div class="note">
                                <strong>Important:</strong> The Application ID is sometimes called "Account ID" in the Cloudflare interface. It's a 32-character hexadecimal string.
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="cloudflare_email">Email</label>
                    <div class="field-description">Email address associated with your Cloudflare account</div>
                    <input type="email" class="form-control" id="cloudflare_email" name="cloudflare_email" value="[% credentials.cloudflare.email | html %]">
                </div>
            </div>
        </div>
        
        <!-- Virtualmin Section -->
        <div class="service-section">
            <h2>Virtualmin</h2>
            <div class="service-description">
                <p>Virtualmin is a web hosting control panel for managing websites and servers.</p>
                <p>These credentials are used to authenticate with the Virtualmin API.</p>
                <p>Learn more: <a href="https://www.virtualmin.com/documentation/developer/http-api/" target="_blank">Virtualmin API Documentation</a></p>
            </div>
            
            <div class="service-fields">
                <div class="form-group">
                    <label for="virtualmin_host">Host</label>
                    <div class="field-description">The hostname or IP address of your Virtualmin server</div>
                    <input type="text" class="form-control" id="virtualmin_host" name="virtualmin_host" value="[% credentials.virtualmin.host | html %]">
                </div>
                
                <div class="form-group">
                    <label for="virtualmin_username">Username</label>
                    <div class="field-description">Username for Virtualmin API authentication</div>
                    <input type="text" class="form-control" id="virtualmin_username" name="virtualmin_username" value="[% credentials.virtualmin.username | html %]">
                </div>
                
                <div class="form-group">
                    <label for="virtualmin_password">Password</label>
                    <div class="field-description">Password for Virtualmin API authentication</div>
                    <input type="password" class="form-control" id="virtualmin_password" name="virtualmin_password" value="[% credentials.virtualmin.password | html %]">
                    <button type="button" class="toggle-password" data-target="virtualmin_password">Show</button>
                </div>
            </div>
        </div>
        
        <!-- OPNsense Section -->
        <div class="service-section">
            <h2>OPNsense</h2>
            <div class="service-description">
                <p>OPNsense is an open-source firewall and routing platform.</p>
                <p>These credentials are used to authenticate with the OPNsense API.</p>
                <p>Learn more: <a href="https://docs.opnsense.org/development/api.html" target="_blank">OPNsense API Documentation</a></p>
            </div>
            
            <div class="service-fields">
                <div class="form-group">
                    <label for="opnsense_host">Host</label>
                    <div class="field-description">The hostname or IP address of your OPNsense firewall</div>
                    <input type="text" class="form-control" id="opnsense_host" name="opnsense_host" value="[% credentials.opnsense.host | html %]">
                </div>
                
                <div class="form-group">
                    <label for="opnsense_api_key">API Key</label>
                    <div class="field-description">API key for OPNsense API authentication</div>
                    <input type="password" class="form-control" id="opnsense_api_key" name="opnsense_api_key" value="[% credentials.opnsense.api_key | html %]">
                    <button type="button" class="toggle-password" data-target="opnsense_api_key">Show</button>
                </div>
                
                <div class="form-group">
                    <label for="opnsense_api_secret">API Secret</label>
                    <div class="field-description">API secret for OPNsense API authentication</div>
                    <input type="password" class="form-control" id="opnsense_api_secret" name="opnsense_api_secret" value="[% credentials.opnsense.api_secret | html %]">
                    <button type="button" class="toggle-password" data-target="opnsense_api_secret">Show</button>
                </div>
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <a href="[% c.uri_for('/') %]" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
    
    <div class="api-docs-link">
        <h3>API Documentation</h3>
        <p>For more information on how to use these API credentials, please refer to the respective service documentation.</p>
        
        <div class="related-tools">
            <h5>Related Tools</h5>
            <ul class="tools-list">
                <li><a href="[% c.uri_for('/cloudflare') %]">Cloudflare DNS Management</a></li>
                <li><a href="[% c.uri_for('/virtualmin') %]">Virtualmin Server Management</a></li>
                <li><a href="[% c.uri_for('/opnsense') %]">OPNsense Firewall Management</a></li>
            </ul>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    // Toggle password visibility
    $('.toggle-password').click(function() {
        const targetId = $(this).data('target');
        const input = $('#' + targetId);
        
        if (input.attr('type') === 'password') {
            input.attr('type', 'text');
            $(this).text('Hide');
        } else {
            input.attr('type', 'password');
            $(this).text('Show');
        }
    });
});
</script>