[% PageVersion = 'Comserv/docs/database_connection_changes.tt,v 0.01 2025/06/10 shanta Exp shanta ' %]
[% IF c.session.debug_mode == 1 %]
    [% PageVersion %]
[% END %]

[% META title = 'Database Connection Changes' %]

<!-- Include documentation CSS -->
<link rel="stylesheet" href="/static/css/documentation.css">

<div class="markdown-content">


## Summary of Changes



The following changes were made to fix database connection issues in the Comserv application:



### 1. Added `db_type` field to database configurations in `db_config.json`



```json

{

    "shanta_ency": {

        "db_type": "mysql",

        "host": "localhost",

        "port": 3306,

        "username": "shanta_forager",

        "password": "UA=nPF8*m+T#",

        "database": "ency"

    },

    "shanta_forager": {

        "db_type": "mysql",

        "host": "localhost",

        "port": 3306,

        "username": "shanta_forager",

        "password": "UA=nPF8*m+T#",

        "database": "shanta_forager"

    }

}

```



### 2. Fixed DSN format in `DBEncy.pm`



Changed from:

```perl

dsn => "dbi:$config->{shanta_ency}->{db_type}:dbname=$config->{shanta_ency}->{database};host=$config->{shanta_ency}->{host};port=$config->{shanta_ency}->{port}",

```



To:

```perl

dsn => "dbi:mysql:database=$config->{shanta_ency}->{database};host=$config->{shanta_ency}->{host};port=$config->{shanta_ency}->{port}",

```



### 3. Fixed DSN format in `DBForager.pm`



Changed from:

```perl

dsn => "dbi:$config->{shanta_forager}->{db_type}:dbname=$config->{shanta_forager}->{database};host=$config->{shanta_forager}->{host};port=$config->{shanta_forager}->{port}",

```



To:

```perl

dsn => "dbi:mysql:database=$config->{shanta_forager}->{database};host=$config->{shanta_forager}->{host};port=$config->{shanta_forager}->{port}",

```



### 4. Fixed DSN format in `RemoteDB.pm`



Changed from:

```perl

my $dsn = "DBI:$config->{db_type}:database=$config->{database};host=$config->{host};port=$config->{port}";

```



To:

```perl

my $dsn = "DBI:mysql:database=$config->{database};host=$config->{host};port=$config->{port}";

```



### 5. Fixed DSN format in `DBSchemaManager.pm`



Changed from:

```perl

my $data_source_name = "DBI:$config->{db_type}:database=$config->{database};host=$config->{host};port=$config->{port}";

```



To:

```perl

my $data_source_name = "DBI:mysql:database=$config->{database};host=$config->{host};port=$config->{port}";

```



### 6. Added `remote_connections` section to `db_config.json`



```json

"remote_connections": {

    "local_ency": {

        "db_type": "mysql",

        "host": "localhost",

        "port": 3306,

        "username": "shanta_forager",

        "password": "UA=nPF8*m+T#",

        "database": "ency"

    }

}

```



### 7. Added documentation



Created a comprehensive guide for database connection configuration in:

`/home/shanta/PycharmProjects/comserv2/Comserv/docs/database_connection.md`



## Reason for Changes



The primary issue was that the DSN string was missing the proper database driver prefix, causing errors like:

"Can't connect to data source 'dbi::dbname=ency;host=localhost;port=3306' because I can't work out what driver to use"



The correct format for MySQL connections is now used consistently:

"dbi:mysql:database=DATABASE_NAME;host=HOST;port=PORT"
</div>
